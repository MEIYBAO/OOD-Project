#!/usr/bin/env node


"use strict";

var _require = require("fs"),
    readdirSync = _require.readdirSync,
    readFileSync = _require.readFileSync,
    writeFileSync = _require.writeFileSync,
    lstatSync = _require.lstatSync;

var _require2 = require("child_process"),
    exec = _require2.exec;

var path = require("path");
var prettier = require("prettier");
var chalk = require('chalk');
var config = require(process.env.PWD + "/.prettierrc");
var sgf = require("staged-git-files");

console.log(chalk.yellow("running precommit hook..."));

sgf(function (err, results) {
    if (err) return err;

    var stagedFiles = results.filter(function (file) {
        return file.status !== "Deleted";
    }).map(function (file) {
        return file.filename;
    });

    Object.keys(config).map(function (key) {
        return formatFiles(config[key], stagedFiles).filter(Boolean).map(function (stagedFiles) {
            console.log("formatting " + chalk.bold(stagedFiles));
            return stagedFiles;
        }).map(function (file) {
            return exec("git add " + file);
        });
    });
});

var formatFiles = function formatFiles(_ref, stagedFiles) {
    var write = _ref.write,
        extensions = _ref.extensions,
        options = _ref.options;

    return stagedFiles.map(function (filePath) {
        if (!checkExtension(filePath, extensions)) return;

        var file = readFileSync(filePath, { encoding: "utf-8" });
        var formattedFile = prettier.format(file, options);

        writeFileSync(filePath, formattedFile, { encoding: "utf-8", flag: "w" });

        return filePath;
    });
};

var checkExtension = function checkExtension(filename, extensions) {
    return extensions.map(function (extension) {
        var fileExtension = filename.substr(filename.lastIndexOf("."));

        return fileExtension == extension;
    }).includes(true);
};
//# sourceMappingURL=index.js.map